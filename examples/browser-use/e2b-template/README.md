# Browser-Use è¿œç¨‹ Chromium è¿æ¥è§£å†³æ–¹æ¡ˆ

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œè®© `browser-use` å¯ä»¥åœ¨æœ¬åœ°é€šè¿‡ Chrome DevTools Protocol (CDP) è¿æ¥åˆ°è¿è¡Œåœ¨ E2B sandbox ä¸­çš„è¿œç¨‹ Chromium å®ä¾‹ã€‚

## æ ¸å¿ƒé—®é¢˜

åœ¨äº‘ç«¯ sandbox ç¯å¢ƒä¸­ï¼Œ`browser-use` è¿æ¥è¿œç¨‹ Chromium é¢ä¸´ä¸¤ä¸ªä¸»è¦æŒ‘æˆ˜ï¼š

1. **Host Header å®‰å…¨é™åˆ¶** - Chromium æ‹’ç»æ¥è‡ªéæœ¬åœ°åŸŸåçš„ CDP è¿æ¥è¯·æ±‚
2. **WebSocket URL é‡å†™** - éœ€è¦å°†å†…éƒ¨åœ°å€ (`127.0.0.1:9222`) é‡å†™ä¸ºå¤–éƒ¨å¯è®¿é—®åœ°å€

## è§£å†³æ–¹æ¡ˆæ¶æ„

### æ•´ä½“æµç¨‹

```
æœ¬åœ° browser-use â†’ E2Bå¤–éƒ¨åŸŸå:9223 â†’ Goåå‘ä»£ç† â†’ Chromium:9222
```

### æ ¸å¿ƒç»„ä»¶

1. **æ‰‹åŠ¨ä¸‹è½½çš„ Chromium** - æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å…åŒ…ç®¡ç†å™¨é™åˆ¶
2. **å¢å¼ºç‰ˆ Go åå‘ä»£ç†** - æ™ºèƒ½å¤„ç† Host header å’Œ WebSocket URL é‡å†™  
3. **E2B Sandbox** - æä¾›å®¹å™¨åŒ–è¿è¡Œç¯å¢ƒ

## å·¥ä½œæµç¨‹

### 1. å®¹å™¨å¯åŠ¨é˜¶æ®µ
- ä» Google å®˜æ–¹ä¸‹è½½æœ€æ–° Chromium äºŒè¿›åˆ¶æ–‡ä»¶
- å¯åŠ¨ Chromiumï¼Œç»‘å®šåˆ°å†…éƒ¨åœ°å€ `127.0.0.1:9222`
- å¯åŠ¨ Go åå‘ä»£ç†ï¼Œç›‘å¬å¤–éƒ¨åœ°å€ `0.0.0.0:9223`

### 2. è¿æ¥å»ºç«‹é˜¶æ®µ  
- `browser-use` å‘ E2B å¤–éƒ¨åŸŸåå‘èµ·è¿æ¥è¯·æ±‚
- åå‘ä»£ç†æ‹¦æˆªè¯·æ±‚ï¼Œé‡å†™ Host header ä¸º `127.0.0.1:9222`
- Chromium æ¥æ”¶åˆ°"æœ¬åœ°è¯·æ±‚"ï¼Œé€šè¿‡å®‰å…¨éªŒè¯

### 3. CDP åè®®äº¤äº’é˜¶æ®µ

`browser-use` éµå¾ªæ ‡å‡†çš„ Chrome DevTools Protocol è¿æ¥æµç¨‹ï¼š

**ç¬¬ä¸€æ­¥ï¼šè·å– WebSocket è¿æ¥ä¿¡æ¯**
```
browser-use â†’ GET https://9223-sandbox-host/json/version/
            â†“ (åå‘ä»£ç†é‡å†™ Host header)
            â†’ GET http://127.0.0.1:9222/json/version/
```

**Chrome åŸå§‹å“åº”ï¼š**
```json
{
  "Browser": "Chrome/138.0.7204.168",
  "webSocketDebuggerUrl": "ws://127.0.0.1:9222/devtools/browser/abc123"
}
```

**åå‘ä»£ç†åŠ¨æ€é‡å†™å“åº”ï¼š**
```json
{
  "Browser": "Chrome/138.0.7204.168", 
  "webSocketDebuggerUrl": "wss://9223-sandbox-host/devtools/browser/abc123"
}
```

**ç¬¬äºŒæ­¥ï¼šå»ºç«‹ WebSocket è¿æ¥**
```
browser-use â†’ WSS wss://9223-sandbox-host/devtools/browser/abc123
            â†“ (åå‘ä»£ç†å¤„ç† WebSocket å‡çº§ + Host é‡å†™)
            â†’ WS ws://127.0.0.1:9222/devtools/browser/abc123
```

**å…³é”®é‡å†™ç‚¹ï¼š**
- `ws://` â†’ `wss://` (E2B HTTPS ç¯å¢ƒè¦æ±‚å®‰å…¨ WebSocket)
- `127.0.0.1:9222` â†’ `9223-sandbox-host` (é‡å†™ä¸ºå¤–éƒ¨å¯è®¿é—®åœ°å€)
- Host header: `sandbox-host` â†’ `127.0.0.1:9222` (ç»•è¿‡ Chromium å®‰å…¨é™åˆ¶)

**ä¸ºä»€ä¹ˆéœ€è¦é‡å†™ï¼š**
- Chromium çš„å®‰å…¨æœºåˆ¶åªå…è®¸æœ¬åœ°åœ°å€è®¿é—® CDP
- E2B sandbox é€šè¿‡ HTTPS å¯¹å¤–æä¾›æœåŠ¡ï¼Œéœ€è¦ WSS åè®®
- `browser-use` éœ€è¦è·å¾—æ­£ç¡®çš„å¤–éƒ¨ WebSocket URL æ‰èƒ½è¿æ¥

### 4. å®æ—¶é€šä¿¡é˜¶æ®µ
- WebSocket è¿æ¥å»ºç«‹åï¼Œæ‰€æœ‰ CDP å‘½ä»¤é€æ˜ä»£ç†
- `browser-use` å‘é€æ“ä½œæŒ‡ä»¤ (ç‚¹å‡»ã€è¾“å…¥ã€æˆªå›¾ç­‰)
- Chromium è¿”å›é¡µé¢çŠ¶æ€å’Œå“åº”æ•°æ®
- åå‘ä»£ç†ç¡®ä¿åŒå‘é€šä¿¡çš„ç¨³å®šæ€§

## å…³é”®ç‰¹æ€§

### ğŸ›¡ï¸ å®‰å…¨ç»•è¿‡
- æ™ºèƒ½ Host header é‡å†™ï¼Œç»•è¿‡ Chromium å®‰å…¨é™åˆ¶
- æ”¯æŒå¤šç§ URL æ ¼å¼è¯†åˆ«å’Œè½¬æ¢

### ğŸ”Œ åè®®å…¼å®¹  
- å®Œæ•´æ”¯æŒ HTTP å’Œ WebSocket åè®®
- è‡ªåŠ¨å¤„ç† `/json/version` å’Œ `/json` ç«¯ç‚¹

### ğŸ“Š ç”Ÿäº§å°±ç»ª
- å†…ç½®å¥åº·æ£€æŸ¥ (`/health`) å’Œæ€§èƒ½ç›‘æ§ (`/metrics`)
- å¯é…ç½®çš„è¶…æ—¶ã€æ—¥å¿—çº§åˆ«ç­‰å‚æ•°

### ğŸ¯ é«˜æ€§èƒ½
- åªå¯¹å¿…è¦çš„ç«¯ç‚¹è¿›è¡Œæ‹¦æˆªå¤„ç†
- å…¶ä»–æµé‡ç›´æ¥é€æ˜ä»£ç†ï¼Œæœ€å°åŒ–å¼€é”€

## éƒ¨ç½²æ–¹å¼

### ä¸€é”®æ„å»ºï¼ˆæ¨èï¼‰
```bash
# è¿è¡Œä¸€é”®æ„å»ºè„šæœ¬
./build.sh
```

æ„å»ºè„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æ£€æŸ¥ Go å’Œ E2B CLI ä¾èµ–
2. ç¼–è¯‘ Go åå‘ä»£ç†ä¸º Linux x86 äºŒè¿›åˆ¶æ–‡ä»¶  
3. æ„å»º E2B Template

### æ‰‹åŠ¨æ„å»º
å¦‚éœ€æ‰‹åŠ¨æ„å»ºï¼Œå¯ä»¥åˆ†æ­¥æ‰§è¡Œï¼š

```bash
# 1. ç¼–è¯‘åå‘ä»£ç†
GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -ldflags="-s -w" -o reverse-proxy reverse-proxy.go

# 2. æ„å»ºæ¨¡æ¿
e2b template build -c "/app/.browser-use/start-up.sh"
```

### æœ¬åœ°è¿æ¥
```python
from e2b_code_interpreter import Sandbox
from browser_use import Agent

# åˆ›å»º sandbox
sandbox = Sandbox(template="your-template-id")

# è·å– Chrome è¿æ¥åœ°å€ï¼ˆç«¯å£ 9223ï¼‰
host = sandbox.get_host(9223)
cdp_url = f"https://{host}"

# è¿æ¥ browser-use
agent = Agent(
    task="ä½ çš„ä»»åŠ¡",
    llm=llm,
    use_vision=True
)

# ä½¿ç”¨è¿œç¨‹ Chrome
result = agent.run(cdp_url=cdp_url)
```

## ç½‘ç»œæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTPS     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   browser-use   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  E2B External    â”‚
â”‚     (æœ¬åœ°)      â”‚              â”‚   Domain:9223    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â”‚ HTTP
                                           â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚   Go Reverse     â”‚
                                 â”‚     Proxy        â”‚
                                 â”‚  (Hosté‡å†™)      â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â”‚ HTTP  
                                           â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚     Chromium     â”‚
                                 â”‚  127.0.0.1:9222  â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ–¹æ¡ˆä¼˜åŠ¿

- âœ… **å¼€ç®±å³ç”¨** - ä¸€æ¬¡é…ç½®ï¼Œç¨³å®šè¿è¡Œ
- âœ… **ç‰ˆæœ¬æœ€æ–°** - æ€»æ˜¯ä½¿ç”¨ Google æœ€æ–° Chromium æ„å»º
- âœ… **æ€§èƒ½ä¼˜åŒ–** - ç²¾ç¡®æ‹¦æˆªï¼Œæœ€å°åŒ–ä»£ç†å¼€é”€  
- âœ… **ç›‘æ§å®Œå–„** - å†…ç½®å¥åº·æ£€æŸ¥å’Œæ€§èƒ½æŒ‡æ ‡
- âœ… **å®¹å™¨å‹å¥½** - ä¸“ä¸º Docker/E2B ç¯å¢ƒè®¾è®¡
- âœ… **åè®®å®Œæ•´** - å…¨é¢æ”¯æŒ CDP çš„ HTTP å’Œ WebSocket é€šä¿¡
